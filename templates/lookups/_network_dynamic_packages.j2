{% set network_dynamic_packages_tpl = [] %}
{% if network_interfaces|d() %}
{%   for iface in network_interfaces %}
{%     if (iface.state | d('present') == 'present' and iface.type | d()) %}
{%       if iface.type == 'vlan' and packages['proxmox-ve'] is not defined %}
{%         set _ = network_dynamic_packages_tpl.append('vlan') %}
{%       elif iface.type == 'bridge' %}
{%         set _ = network_dynamic_packages_tpl.append('bridge-utils') %}
{%       elif iface.type == 'bond' %}
{%         set _ = network_dynamic_packages_tpl.append('ifenslave') %}
{%       elif iface.type == 'eth' and iface.ucarp | d() %}
{%         set _ = network_dynamic_packages_tpl.append('ucarp') %}
{%       endif %}
{%     endif %}
{%   endfor %}
{% endif %}
{{ network_dynamic_packages_tpl | unique | to_yaml }}
